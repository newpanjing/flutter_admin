# 动态路由功能测试说明

## 功能概述

本系统已实现根据API配置动态注册路由的功能，所有动态路由都会指向商品管理页面。

## 实现的功能

### 1. 动态路由注册
- 在应用启动时从 `/api/config/` 接口获取菜单配置
- 根据API返回的菜单项自动生成Flutter路由
- 所有动态路由都指向 `ProductManagementPage`

### 2. 路由转换逻辑
- API URL 自动转换为 Flutter 路由路径
- 避免与现有静态路由冲突
- 支持多级路径结构

### 3. 系统管理界面集成
- 在系统管理页面显示当前动态路由信息
- 支持重新加载动态路由
- 提供查看所有路由的对话框

## API 数据格式

系统期望的API响应格式：

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "site_name": "ERP管理系统",
    "menus": [
      {
        "name": "客户管理",
        "url": "/api/customer/",
        "icon": "fa-users"
      },
      {
        "name": "商品管理",
        "url": "/api/product/",
        "icon": "fa-box"
      },
      {
        "name": "库存管理",
        "url": "/api/inventory/",
        "icon": "fa-warehouse"
      }
    ]
  }
}
```

## 路由转换示例

| API URL | 转换后的路由 | 路由名称 |
|---------|-------------|----------|
| `/api/customer/` | `/customer` | `客户` |
| `/api/product/` | `/product` | `商品` |
| `/api/inventory/` | `/inventory` | `库存` |
| `/api/sale/order/` | `/sale/order` | `销售订单` |

## 测试步骤

### 1. 启动应用
```bash
# 注意：根据用户指令，不执行 flutter run
# 应用会在启动时自动初始化动态路由
```

### 2. 检查动态路由
1. 登录系统
2. 进入「系统管理」页面
3. 查看「动态路由信息」卡片
4. 点击「查看全部」按钮查看所有动态路由

### 3. 测试路由跳转
1. 在侧边栏菜单中点击动态生成的菜单项
2. 验证是否正确跳转到商品管理页面
3. 检查URL是否为动态生成的路由路径

### 4. 重新加载测试
1. 在系统管理页面点击「重新加载路由」按钮
2. 验证路由信息是否更新
3. 检查是否显示成功提示消息

## 错误处理

### API调用失败
- 如果API调用失败，系统会使用空的动态路由列表
- 在控制台输出错误信息
- 不影响应用的正常启动

### 路由冲突处理
- 自动检测与现有静态路由的冲突
- 为冲突的路由添加 `dynamic-` 前缀
- 确保路由的唯一性

## 注意事项

1. **GoRouter限制**: GoRouter不支持运行时动态添加路由，因此路由必须在应用启动时初始化
2. **页面指向**: 所有动态路由都指向商品管理页面，符合用户需求
3. **性能考虑**: 动态路由信息缓存在内存中，避免重复API调用
4. **错误恢复**: 提供重新加载功能，支持运行时更新路由信息

## 扩展功能

如需扩展功能，可以考虑：
- 支持不同菜单项指向不同页面
- 添加路由权限控制
- 实现路由参数传递
- 支持嵌套路由结构